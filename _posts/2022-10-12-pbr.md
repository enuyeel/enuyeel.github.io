---
layout: post
title: "Physically Based Rendering"
permalink: /blog/:year/:month/:day/:title
---

The brightness of a surface is defined as its surface radiance. How do you then go about measuring the brightness of a surface? <br>
Imagine a sensor of some area at a distance to the surface of interest. If you move the sensor further away from the surface, it will receive less light since the solid angle with respect to each point on the surface decreases. By definition, the solid angle is inversely proportional to the radius squared, and only the radius increases in this scenario, hence the less light. <br> 
If you increase the area of the surface, on the other hand, more light will enter the sensor, therefore increasing the perceived brightness.<br>
Therefore, when you define the brightness of a surface, you need to normalize with respect to both the area of the surface as well as the solid angle subtended by each point in the surface with respect to your sensor. <br>
This brings us to the definition that radiance is defined as flux $$\Phi$$ per unit (foreshortened) area $$dAcos\theta_{r}$$ per unit solid angle $$d\omega$$. It's good to be reminded now that it depends on the reflectance properties of a surface, which I'll go more in-depth about later in the article. <br>

$$L=\frac{d^2\Phi}{(dAcos\theta_{r})d\omega}$$

Don't let the complex Mathematical notation throw you off, though! If we consider the solid angle $$\omega$$ and the area $$A$$ to be infinitesimal, we can effectively translate the surface to a single point (or fragment) and the solid angle into a directional vector from a single point to the light source. Although the actual implementations won't closely resemble the above formula, this radiometry concept is the backbone of Physically Based Rendering (PBR), and many different models describing the way that light scatters at surfaces are somewhat directly and indirectly derived from it. <br>
<br>\*\*\*<br><br>
It is to be noted a single point in the micro-level can be modeled as a collection of small microfacets, hence the Microfacet Model. Our seemingly flat point of interest on the surface at the macro-level is then really a collective of individual microfacets at the micro-level, and it's their aggregate behavior against the light that determines the observed scattering. <br>
It is our interest how every microfacets on a differential area $$dA$$ scatter light in all different directions, not just a single microfacet, thus a need for integrating the surface response over a hemisphere, although we can assume that a batch of incident rays (technically not a single ray of light anymore, since it has to hit off every microfacets within hemisphere) are all parallel to each other. <br>
However, it is computationally heavy to compute integration for every shaded fragment, so our surface response, which consists of diffuse and specular components should effectively be boiled down to a statistical approximation. <br>
For a refresher, the moment a light ray hits a surface, it gets split into both a reflection part which doesn't enter the surface and gets directly reflected and a refraction part which enters the surface and either gets absorbed or later emerges from the surface at a distance. The former is responsible for the specular component, while the latter is responsible for the diffuse component. It should be mentioned that conductors (e.g purely metallic materials) have no diffuse component. <br>
There are many different versions of general microfacet model equations available online, so I won't bother to list any of them here, but it should be noted that my PBR implementation for the most part is based on Google Filament.<br>

<br>

- [Radiometric Concepts by Shree K. Nayar](https://youtu.be/tflz0loWhIY)
- [Google Filament Documentation](https://google.github.io/filament/Filament.html)
- [Google Filament shading_model_standard.fs](https://google.github.io/filament/Filament.html)
- [Google Filament brdf.fs](https://github.com/google/filament/blob/main/shaders/src/brdf.fs)
- [PBR Book 8.4 Microfacet Models](https://www.pbr-book.org/3ed-2018/Reflection_Models/Microfacet_Models)
- [learnopengl.com PBR Part I "Theory"](https://learnopengl.com/PBR/Theory)